(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{401:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"vue源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue源码"}},[t._v("#")]),t._v(" Vue源码")]),t._v(" "),s("h2",{attrs:{id:"vue3源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue3源码"}},[t._v("#")]),t._v(" Vue3源码")]),t._v(" "),s("h3",{attrs:{id:"set、map、weakset、weakmap区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set、map、weakset、weakmap区别"}},[t._v("#")]),t._v(" Set、Map、WeakSet、WeakMap区别？")]),t._v(" "),s("h4",{attrs:{id:"set-集合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set-集合"}},[t._v("#")]),t._v(" Set（集合）")]),t._v(" "),s("ul",[s("li",[t._v("存储结构：[值, 值]，存储唯一的值（不允许重复）。")]),t._v(" "),s("li",[t._v("键类型：任意类型的值（包括对象、原始值）。")]),t._v(" "),s("li",[t._v("可遍历：是（支持 forEach、keys()、values()、entries() 等方法）。")]),t._v(" "),s("li",[t._v("引用类型：强引用（即使对象不再使用，也不会被垃圾回收）。")])]),t._v(" "),s("p",[t._v("常用方法：")]),t._v(" "),s("ul",[s("li",[t._v("add(value)：添加值。")]),t._v(" "),s("li",[t._v("delete(value)：删除值。")]),t._v(" "),s("li",[t._v("has(value)：检查是否存在某值。")]),t._v(" "),s("li",[t._v("clear()：清空集合。")])]),t._v(" "),s("p",[t._v("使用场景：数组去重、集合运算（并集、交集等）。")]),t._v(" "),s("h4",{attrs:{id:"weakset-弱集合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#weakset-弱集合"}},[t._v("#")]),t._v(" WeakSet（弱集合）")]),t._v(" "),s("ul",[s("li",[t._v("存储结构：[值, 值]，但仅能存储对象（不能是原始值）。")]),t._v(" "),s("li",[t._v("键类型：仅对象（如 {}、new Object()）。")]),t._v(" "),s("li",[t._v("可遍历：否（没有 size 属性，也不能用 forEach 或迭代方法）。")]),t._v(" "),s("li",[t._v("引用类型：弱引用（如果对象在其他地方没有被引用，会被垃圾回收自动清除）。")])]),t._v(" "),s("p",[t._v("常用方法：")]),t._v(" "),s("ul",[s("li",[t._v("add(obj)：添加对象。")]),t._v(" "),s("li",[t._v("delete(obj)：删除对象。")]),t._v(" "),s("li",[t._v("has(obj)：检查是否存在某对象。")])]),t._v(" "),s("p",[t._v("使用场景：临时存储对象（如 DOM 节点是否已被处理）。")]),t._v(" "),s("h4",{attrs:{id:"map-字典"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#map-字典"}},[t._v("#")]),t._v(" Map（字典）")]),t._v(" "),s("ul",[s("li",[t._v("存储结构：[键, 值]，键值对集合。")]),t._v(" "),s("li",[t._v("键类型：任意类型（对象、原始值均可）。")]),t._v(" "),s("li",[t._v("可遍历：是（支持 forEach、keys()、values()、entries() 等方法）。")]),t._v(" "),s("li",[t._v("引用类型：强引用（键和值都不会被垃圾回收）。")])]),t._v(" "),s("p",[t._v("常用方法：")]),t._v(" "),s("ul",[s("li",[t._v("set(key, value)：设置键值对。")]),t._v(" "),s("li",[t._v("get(key)：获取值。")]),t._v(" "),s("li",[t._v("delete(key)：删除键值对。")]),t._v(" "),s("li",[t._v("has(key)：检查是否存在某键。")]),t._v(" "),s("li",[t._v("clear()：清空字典。")])]),t._v(" "),s("p",[t._v("使用场景：需要复杂键（如对象）的映射、缓存、数据关联。")]),t._v(" "),s("h4",{attrs:{id:"weakmap-弱字典"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#weakmap-弱字典"}},[t._v("#")]),t._v(" WeakMap（弱字典）")]),t._v(" "),s("ul",[s("li",[t._v("存储结构：[键, 值]，但键必须是对象（值可以是任意类型）。")]),t._v(" "),s("li",[t._v("键类型：仅对象（不能是原始值）。")]),t._v(" "),s("li",[t._v("可遍历：否（没有 size 属性，也不能用 forEach 或迭代方法）。")]),t._v(" "),s("li",[t._v("引用类型：弱引用（仅对键弱引用，如果键对象在其他地方没有被引用，会被垃圾回收，对应的值也会被释放）。")])]),t._v(" "),s("p",[t._v("常用方法：")]),t._v(" "),s("ul",[s("li",[t._v("set(key, value)：设置键值对（key 必须是对象）。")]),t._v(" "),s("li",[t._v("get(key)：获取值。")]),t._v(" "),s("li",[t._v("delete(key)：删除键值对。")]),t._v(" "),s("li",[t._v("has(key)：检查是否存在某键。")])]),t._v(" "),s("p",[t._v("使用场景：存储对象的私有数据或元数据（避免内存泄漏）。")]),t._v(" "),s("p",[t._v("帮助内存管理的数据结构：WeakMap,WeakSet。尽管JavaScript没有直接暴露垃圾回收器API。但语言\n提供几个间接观察垃圾回收的数据结构，能用于内存管理。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("特性")]),t._v(" "),s("th",[t._v("Set")]),t._v(" "),s("th",[t._v("WeakSet")]),t._v(" "),s("th",[t._v("Map")]),t._v(" "),s("th",[t._v("WeakMap")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("存储结构")]),t._v(" "),s("td",[t._v("[值，值]")]),t._v(" "),s("td",[t._v("[对象，对象]")]),t._v(" "),s("td",[t._v("[键，值]")]),t._v(" "),s("td",[t._v("[对象键，值]")])]),t._v(" "),s("tr",[s("td",[t._v("键类型")]),t._v(" "),s("td",[t._v("任意值")]),t._v(" "),s("td",[t._v("仅对象")]),t._v(" "),s("td",[t._v("任意值")]),t._v(" "),s("td",[t._v("仅对象")])]),t._v(" "),s("tr",[s("td",[t._v("可遍历性")]),t._v(" "),s("td",[t._v("可")]),t._v(" "),s("td",[t._v("不可")]),t._v(" "),s("td",[t._v("可")]),t._v(" "),s("td",[t._v("不可")])]),t._v(" "),s("tr",[s("td",[t._v("引用类型")]),t._v(" "),s("td",[t._v("强引用")]),t._v(" "),s("td",[t._v("弱引用")]),t._v(" "),s("td",[t._v("强引用")]),t._v(" "),s("td",[t._v("弱引用（仅键）")])]),t._v(" "),s("tr",[s("td",[t._v("垃圾回收影响")]),t._v(" "),s("td",[t._v("不回收")]),t._v(" "),s("td",[t._v("自动回收")]),t._v(" "),s("td",[t._v("不回收")]),t._v(" "),s("td",[t._v("自动回收")])]),t._v(" "),s("tr",[s("td",[t._v("典型用途")]),t._v(" "),s("td",[t._v("去重、集合运算")]),t._v(" "),s("td",[t._v("临时对象管理")]),t._v(" "),s("td",[t._v("复杂键映射")]),t._v(" "),s("td",[t._v("对象私有数据")])])])]),t._v(" "),s("h4",{attrs:{id:"关键性总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关键性总结"}},[t._v("#")]),t._v(" 关键性总结")]),t._v(" "),s("ul",[s("li",[t._v("Set vs WeakSet")])]),t._v(" "),s("p",[t._v("Set 可以存储任意值，WeakSet 只能存储对象。")]),t._v(" "),s("p",[t._v("Set 可遍历，WeakSet 不可遍历。")]),t._v(" "),s("p",[t._v("WeakSet 对对象是弱引用，适合临时存储（如 DOM 节点管理）。")]),t._v(" "),s("ul",[s("li",[t._v("Map vs WeakMap")])]),t._v(" "),s("p",[t._v("Map 的键可以是任意类型，WeakMap 的键必须是对象。")]),t._v(" "),s("p",[t._v("Map 可遍历，WeakMap 不可遍历。")]),t._v(" "),s("p",[t._v("WeakMap 对键是弱引用，适合存储对象的私有数据（避免内存泄漏）。")]),t._v(" "),s("ul",[s("li",[t._v("强引用 vs 弱引用")])]),t._v(" "),s("p",[t._v("Set 和 Map 会阻止垃圾回收，可能导致内存泄漏。")]),t._v(" "),s("p",[t._v("WeakSet 和 WeakMap 不会阻止垃圾回收，适合临时存储。")]),t._v(" "),s("h2",{attrs:{id:"vue讲述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue讲述"}},[t._v("#")]),t._v(" Vue讲述")]),t._v(" "),s("h3",{attrs:{id:"响应式模块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#响应式模块"}},[t._v("#")]),t._v(" 响应式模块")]),t._v(" "),s("div",{staticClass:"language-md extra-class"},[s("pre",{pre:!0,attrs:{class:"language-md"}},[s("code",[t._v("effect是个副作用，数据发生改变，立即执行effect。我们通过数据代理，在get和set方法进行切面编程，\nget里面进行依赖收集，把effect中 使用到的变量 和 effect 进行关联，形成一个映射表。\nget里面进行触发更新，数据发生改变，调用映射表的effect方法，进行页面数据的渲染(innerHTML)。\n\neffect: 数据发生改变立即执行effect\nwatch, computed 都是基于 effect ，\neffect(() => {\n    document.innerHTML = "),s("span",{pre:!0,attrs:{class:"token code-snippet code keyword"}},[t._v("`hello${name}`")]),t._v(";\n}, {}); // 执行函数，选项\n写在effect里面的变量，才具有响应式。\n父子组件，就是嵌套的effect;\n\n设计响应式的effect\neffect访问 对象的属性进行 依赖收集， 书写innerHTML = 啥 进行触发更新。\ntrackEffect, triggerEffect\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("1.")]),t._v(" 在proxy 的get 进行 依赖收集，\n\n收集这个对象上的这个属性和 effect关联在一起。\n收集依赖的数据格式 \n Map:  obj:  {属性 ： Map:  effect, effect, effect   }\n嵌套Map ,\n第一层： 对象，  Map\n第二层： 属性， Map \n\n\n// 将当前的effect放入到dep （映射表）中，后续可以根据值得变化触发此dep中存放的 effect 。\n\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("2.")]),t._v(" 触发更新\n\n\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("3.")]),t._v(" 解决effect 的遗留问题\neffect 有条件（前后的依赖不一样的各种情况） state.flag ? state.name : state.age;\n（effect在进行第二次依赖收集，有个简单的diff算法））\neffect 有重复的，映射表要去重  state.name + state.name\n\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("4.")]),t._v(" effect调度实现 （effect第二个参数scheduler, 数据更新了，不重新渲染，走自己的逻辑。\n还可以赋值给变量即函数名，然后在scheduler中调用）。\n\n"),s("span",{pre:!0,attrs:{class:"token list punctuation"}},[t._v("5.")]),t._v(" 解决 innerHTML = state.name; state.name = 22; 陷入死循环\n  当取的值也是对象的时候，我需要对这个对象 再进行代理，递归代理\n\n\nreactive只能针对对象， proxy就是针对对象呀\n\nref 实现原理， 可以是基础类型，可以是对象\n包了一层，成为对象。拥有三个属性：_v,  get方法 ，set方法\ncontructor：判断是不是对象 ,是的话，包一层reactive\n\n其他API: toRef, toRefs, proxyRef, proxyRefs\n\n书写computed, 也是ref (ref特征 _v, get value方法， set value方法)\n\n思路：\n\n")])])]),s("p",[t._v("缩略版 computed")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在effect 里用到 fullname.value才行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// const fullname = computed(() => state.firstname + state.name);")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// effect(() => {")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   console.log(fullname.value);")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// })")]),t._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ComputedRefImpl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" _value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    getter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ComputedGetter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" _setter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ComputedSetter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("triggerRefValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ComputedValueMaybeDirty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("trackRefValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_value\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newValue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_setter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #region polyfill _dirty for backward compatibility third party code for Vue <= 3.3.x")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_dirty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dirty\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_dirty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dirty "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" v\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #endregion")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("reactiveEffect: 接收参数: getter函数，调度器\n收集依赖，")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveEffect"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  active "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  deps"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * Can be attached after creation\n   * @internal\n   */")]),t._v("\n  computed"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ComputedRefImpl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * @internal\n   */")]),t._v("\n  allowRecurse"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),t._v("\n\n  onStop"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// dev only")]),t._v("\n  onTrack"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DebuggerEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// dev only")]),t._v("\n  onTrigger"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DebuggerEvent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * @internal\n   */")]),t._v("\n  _dirtyLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Dirty\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * @internal\n   */")]),t._v("\n  _trackId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * @internal\n   */")]),t._v("\n  _runnings "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * @internal\n   */")]),t._v("\n  _queryings "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * @internal\n   */")]),t._v("\n  _depsLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("fn")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("trigger")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" scheduler"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" EffectScheduler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    scope"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" EffectScope"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("recordEffectScope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" scope"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dirty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_dirtyLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ComputedValueMaybeDirty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_dirtyLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NotDirty\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_queryings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pauseTracking")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dep "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("computed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("triggerComputed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("computed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_dirtyLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ComputedValueDirty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resetTracking")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_queryings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_dirtyLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ComputedValueDirty\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dirty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_dirtyLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" v "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Dirty "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NotDirty\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_dirtyLevel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DirtyLevels"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NotDirty\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastShouldTrack "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" shouldTrack\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" activeEffect\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      shouldTrack "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      activeEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_runnings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("preCleanupEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postCleanupEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_runnings"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("\n      activeEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lastEffect\n      shouldTrack "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lastShouldTrack\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("active"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("preCleanupEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("postCleanupEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onStop"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("active "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("effect:")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token generic-function"}},[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("effect")]),s("span",{pre:!0,attrs:{class:"token generic class-name"}},[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("fn")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("T")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReactiveEffectOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReactiveEffectRunner "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ReactiveEffectRunner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effect "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fn "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ReactiveEffectRunner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fn\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" _effect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveEffect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NOOP")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dirty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      _effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("extend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scope"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("recordEffectScope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scope"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lazy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    _effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" runner "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" ReactiveEffectRunner\n  runner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _effect\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" runner\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("特性\tReactiveEffect 类\teffect 函数\n层级\t底层实现类\t高级 API（基于 ReactiveEffect）\n使用方式\t需实例化并手动调用 run()\t直接传入函数，自动执行和追踪\n调度控制\t支持自定义调度器（scheduler）\t通过 effect 的选项间接支持\n停止监听\t调用 stop() 方法\t返回 stop 函数\n典型用途\tVue 内部实现（如渲染、computed、watch）\t开发者显式管理副作用")]),t._v(" "),s("h3",{attrs:{id:"runtime-dom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#runtime-dom"}},[t._v("#")]),t._v(" runtime-dom")]),t._v(" "),s("p",[t._v("提供 DOM API (提供一系列dom操作的api方法) ，针对浏览器的")]),t._v(" "),s("ol",[s("li",[t._v("createRenderer(RuntimeCore的方法) 我们可以自己创建渲染器 （自定义渲染器），接收rendererOptions")]),t._v(" "),s("li",[t._v("render(RuntimeCore的方法) 用内置的渲染器来进行渲染 （渲染dom元素）(把虚拟节点变成真实节点)")]),t._v(" "),s("li",[t._v("h方法可以创建一个虚拟dom (接收参数：type, propsOrChildren, children)")])]),t._v(" "),s("p",[t._v("type 标签：div , propsOrChildren 属性 {}")]),t._v(" "),s("p",[t._v("nodeOps 节点渲染\npatchProp 属性渲染： attrs,class,events,props,style\nevents: 希望是一个() => 函数名， 这样可以移除事件和监听事件。")]),t._v(" "),s("p",[t._v("引用关系：runtime-core -> runtime-core -> reactivity")]),t._v(" "),s("h3",{attrs:{id:"runtime-core"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#runtime-core"}},[t._v("#")]),t._v(" runtime-core")]),t._v(" "),s("h4",{attrs:{id:"重点看createrenderer-渲染器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重点看createrenderer-渲染器"}},[t._v("#")]),t._v(" 重点看createRenderer (渲染器)")]),t._v(" "),s("p",[t._v("createRenderer 返回一个对象，有render方法，render方法中 会调用核心函数patch, patch会根据初次渲染和\n更新渲染，把虚拟节点，转化为真实节点。")]),t._v(" "),s("p",[t._v("createRenderer： 可以不针对浏览器的自定义渲染器，实现跨平台。\ncreateRenderer：接收rendererOptions渲染器选项，自己有个render方法，")]),t._v(" "),s("p",[t._v("render: 接收参数： vnode/虚拟dom, Element/dom节点")]),t._v(" "),s("p",[t._v("Vue 3 的 Diff 比 Vue 2 更高效，主要依赖以下优化：")]),t._v(" "),s("p",[t._v("优化策略\t作用\n静态提升（Hoist Static）\t将静态节点（无动态绑定）提取到渲染函数外，复用旧 VNode，避免重复对比。\nPatch Flags\t在 VNode 上标记动态属性（如 class、style），仅对比变化的属性。\nBlock Tree\t将模板划分为动态区块（Block），仅对比区块内的动态节点，跳过静态内容。\n靶向更新\t直接定位到动态节点，减少递归遍历。\n1 << 2 , 二进制数，左移两位。 1  2  4  8 16\n组合起来，1111111， 一下子就看出来，它拥有全部的组合。10001，头和尾的组合。\n| 或运算 1 | 8 得到9， & 与运算")]),t._v(" "),s("p",[t._v("Vue 3 的 Diff 比 Vue 2 更高效，主要依赖以下优化：")]),t._v(" "),s("p",[t._v("优化策略\t作用\n静态提升（Hoist Static）\t将静态节点（无动态绑定）提取到渲染函数外，复用旧 VNode，避免重复对比。\nPatch Flags\t在 VNode 上标记动态属性（如 class、style），仅对比变化的属性。\nBlock Tree\t将模板划分为动态区块（Block），仅对比区块内的动态节点，跳过静态内容。\n靶向更新\t直接定位到动态节点，减少递归遍历。")]),t._v(" "),s("p",[t._v("特性\trender 函数\th 函数\n角色\t组件的视图生成器（返回整个 VNode 树）\t单个 VNode 的工厂函数\n调用者\tVue 内部调用（或开发者手动定义）\t在 render 函数内部调用\n输入\t组件实例的 this（访问状态）\t标签名/组件、props、children\n输出\t完整的 VNode 树\t单个 VNode\n是否必需\t必须有（直接或间接）\t可选（可用 JSX 替代）")]),t._v(" "),s("h4",{attrs:{id:"组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#组件"}},[t._v("#")]),t._v(" 组件")]),t._v(" "),s("p",[t._v("template 会变成 render函数")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" VueComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'durant'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("h")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Fragment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("h")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my name is"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("h")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// h 接收参数（type, propsOrChildren, children）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// type： 是 文本，注释，Fragment, 元素（组件，div...）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("h")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VueComponent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("组件渲染整理流程")]),t._v(" "),s("p",[t._v("创建组件实例\n给实例的属性赋值\n创建一个effect")]),t._v(" "),s("h3",{attrs:{id:"模板变成js语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#模板变成js语法"}},[t._v("#")]),t._v(" 模板变成js语法")]),t._v(" "),s("p",[t._v("diff算法优化：")]),t._v(" "),s("p",[t._v("如果在编写vue3的时候，你直接采用jsx 或者 h 的写法，得不到优化")]),t._v(" "),s("p",[t._v("template 编译成 js 语法时，会有 PatchFlags，标记是文本、class, style等，没有\n使用h, 使用了_createElementVNode。\n反正用h是见得比较多，回头有用到_openBlock,_createElementBlock和_createElementVNode，再看一下吧。")]),t._v(" "),s("ul",[s("li",[t._v("PatchFlags 优化：只考虑属性和内容发生变化")]),t._v(" "),s("li",[t._v("BlockTree: 处理 虚拟DOM 树的层级，v-if,v-else, v-for不确定有多少个")])]),t._v(" "),s("p",[t._v("我觉得直接 编写 h 代码 ，实现 一些插件（eg: vue-draggable-plus等）功能很难的。\n1.它可以通过书写template, 然后通过某些插件进行转换为 h语法。\n2.或者通过vue转换语法的网站，实现代码编写。")]),t._v(" "),s("p",[t._v("template 转换成 js 语法\n1.“语法” 转化成一个对象 ast语法树\n2.对树进行优化 （打标记 patchFlag）\n3.根据转换后的代码生成 一个字符串。")]),t._v(" "),s("p",[t._v("compile(模板) 得到 {\nast: {},\ncode: render函数的字符串\n}")]),t._v(" "),s("p",[t._v("编译主要分为三步")]),t._v(" "),s("ol",[s("li",[t._v("将模板转换成 ast语法树")]),t._v(" "),s("li",[t._v("转换生成 codegennode")]),t._v(" "),s("li",[t._v("转换成 render函数")])]),t._v(" "),s("p",[t._v("状态机：循环每个字符，判断它是什么类型，然后分别进行处理")]),t._v(" "),s("h2",{attrs:{id:"面试题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#面试题"}},[t._v("#")]),t._v(" 面试题")]),t._v(" "),s("h3",{attrs:{id:"请说以下-vue2-响应式数据的理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#请说以下-vue2-响应式数据的理解"}},[t._v("#")]),t._v(" 请说以下 Vue2 响应式数据的理解")]),t._v(" "),s("p",[t._v("源码层面: 内部对所有属性进行了重写，性能问题，如果对象是多层级的，就会递归对象中的属性，增加\ngetter和 setter")]),t._v(" "),s("p",[t._v("我们在使用Vue的时候，如果层级过深（考虑优化），如果数据不是响应式的，就不要放在data中了。\n我们属性取值的时候尽量避免多次取值。如果有些对象放在 data中，但不是响应式的，可以考虑采用\nObject.freeze() 来冻结对象。")]),t._v(" "),s("p",[t._v("多次取值（多次访问get方法）")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 多次访问get方法")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" sum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  sum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"vue2中如何监测数组的变化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue2中如何监测数组的变化"}},[t._v("#")]),t._v(" Vue2中如何监测数组的变化？")]),t._v(" "),s("p",[t._v("vue2 中监测数组的变化 没有采用defineProperty, 因为修改索引的情况不多，如果直接使用defineProperty 会浪费大量性能。\n采用重写数组的变异方法来实现函数劫持。")]),t._v(" "),s("p",[t._v("initData -> observe -> 对我们传入的数组进行原型链修改，后续调用的方法都是 重写后的方法。->\n对数组中每个对象 也再次进行代理")]),t._v(" "),s("p",[t._v("修改数组索引，修改长度是无法进行监控的。arr[1] = 100; arr.length = 300;")]),t._v(" "),s("h3",{attrs:{id:"vue中如何进行依赖收集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue中如何进行依赖收集"}},[t._v("#")]),t._v(" Vue中如何进行依赖收集？")]),t._v(" "),s("p",[t._v("所谓的依赖收集（观察者模式），被观察者指代的是数据(dep), 观察者（watcher）\n一个watcher中 可能对应着 多个数据，watcher 中还需要 保存dep, (重新渲染的时候可以让属性重新记录watcher)")]),t._v(" "),s("p",[t._v("多对多的关系 一个dep 对应多个watcher, 一个watcher 有多个dep。默认渲染的时候会进行依赖收集（会触发get方法），\n数据更新了就找到属性对应的watcher去触发更新。")]),t._v(" "),s("h3",{attrs:{id:"如何理解vue中模板编译原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何理解vue中模板编译原理"}},[t._v("#")]),t._v(" 如何理解Vue中模板编译原理？")]),t._v(" "),s("p",[t._v("我们用户传递的是template 属性，我们需要将这个template 编译成 render函数")]),t._v(" "),s("p",[t._v("template ——> ast语法树\n对语法树进行标记 （标记的是静态节点）\n将ast 语法树生成 render函数")]),t._v(" "),s("p",[t._v("最终每次渲染可以调用render函数返回对应的虚拟节点（递归是先子后父）")]),t._v(" "),s("h3",{attrs:{id:"vue生命周期钩子是如何实现的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue生命周期钩子是如何实现的"}},[t._v("#")]),t._v(" Vue生命周期钩子是如何实现的")]),t._v(" "),s("p",[t._v("内部利用了一个发布订阅模式，将用户写的钩子维护成了一个数组，后续一次调用callback.")]),t._v(" "),s("h2",{attrs:{id:"vue2源码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue2源码"}},[t._v("#")]),t._v(" Vue2源码")]),t._v(" "),s("p",[s("code",[t._v("自己理解，并不一定对")])]),t._v(" "),s("p",[t._v("new Vue() 做了啥？\n1.调用_init方法\n2. 合并选项")]),t._v(" "),s("p",[t._v("Observer类，Dep类，\n渲染完真实DOM,\n再开启监听者模式，Object.defineProperty.\nget: dep.depend(); set: dep.notify();")]),t._v(" "),s("h3",{attrs:{id:"api的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#api的实现"}},[t._v("#")]),t._v(" API的实现")]),t._v(" "),s("h4",{attrs:{id:"ref的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ref的实现"}},[t._v("#")]),t._v(" ref的实现")]),t._v(" "),s("p",[t._v("包了一层对象，{_v, get, set} 里面的_v如果是 引用类型，也是个proxy")])])}),[],!1,null,null,null);s.default=e.exports}}]);