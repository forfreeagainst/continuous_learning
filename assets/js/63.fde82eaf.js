(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{385:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"权限管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权限管理"}},[t._v("#")]),t._v(" 权限管理")]),t._v(" "),s("ul",[s("li",[t._v("根据用户所具备的权限，动态添加路由规则，实现动态渲染菜单。同时通过路由守卫，禁止用户访问非权限内的页面。")]),t._v(" "),s("li",[t._v("通过Axios的请求拦截器和响应拦截器，实现接口权限的控制。")]),t._v(" "),s("li",[t._v("通过自定义全局指令实现细颗粒度权限控制")])]),t._v(" "),s("p",[t._v("扩展就能问到：vue.directive, vue-router, aixos，")]),t._v(" "),s("p",[t._v("token 结合jwt")]),t._v(" "),s("p",[t._v("RBAC 基于角色的权限控制, usePermission")]),t._v(" "),s("h2",{attrs:{id:"为什么要权限控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要权限控制"}},[t._v("#")]),t._v(" 为什么要权限控制？")]),t._v(" "),s("ul",[s("li",[t._v("后端权限：控制数据和用户是否能够操作")]),t._v(" "),s("li",[t._v("前端权限：视图权限。")]),t._v(" "),s("li",[t._v("有时你通过F12，改了一些东西，就能进行非法操作，后端也是有判断的。（自助结汇、自助购汇等）（经办、复核、）")])]),t._v(" "),s("p",[t._v("前端权限控制的好处：")]),t._v(" "),s("ol",[s("li",[t._v("减少没必要的操作或请求")]),t._v(" "),s("li",[t._v("提高用户体验，避免在页面给用户产生困扰。同时减少页面内容的渲染，提高性能。")]),t._v(" "),s("li",[t._v("降低非法操作的可能性")]),t._v(" "),s("li",[t._v("（测试案例）")])]),t._v(" "),s("h2",{attrs:{id:"前端权限控制的思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端权限控制的思路"}},[t._v("#")]),t._v(" 前端权限控制的思路")]),t._v(" "),s("ul",[s("li",[t._v("菜单的控制（菜单权限）：用户登录后，后端返回该用户的权限数据。前端根据权限数据，展示有权限的菜单。")]),t._v(" "),s("li",[t._v("界面的控制（路由权限）：用户没有登录，输入非登录的url, 则需要跳转到登录页面；用户已经登录，输入没有非权限内的url,跳转到404")]),t._v(" "),s("li",[t._v("按钮的控制（按钮权限）：在某个菜单的页面中，展示可进行操作的按钮，比如删除，修改，增加")]),t._v(" "),s("li",[t._v("请求和响应的控制（接口权限）：用户通过非常规操作，通过F12调试工具，把禁用的按钮变成启用，进行发送请求，应被前端所拦截")])]),t._v(" "),s("p",[t._v("菜单的控制 使用Vuex+sessionStorage\n通过vue-router的路由规则后端返回的权限数据， 进行嵌套路由，渲染菜单列表。")]),t._v(" "),s("p",[t._v("界面的控制： 使用token和全局导航守卫, 动态路由规则\n登录的时候：根据用户所具备的权限，动态添加路由规则。防止用户输入没有非权限内的url,进行访问")]),t._v(" "),s("h3",{attrs:{id:"按钮的控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#按钮的控制"}},[t._v("#")]),t._v(" 按钮的控制")]),t._v(" "),s("p",[t._v("通过自定义指令和路由规则的元数据 / 从状态管理获取的用户权限信息，对dom进行样式禁用或移除")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// v-permission = \"{action: 'add'}\"")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vue'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" router "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@/router.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nVue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("direactive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'permission'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("inserted")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" binding")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" action "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" currentRight "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("currentRoute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentRight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentRight"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不具备权限，是要警用，还是直接移除元素")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" binding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'disabled'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("disabled "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("classList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'is-disabled'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parentNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("请求和响应的控制： 通过axios的请求拦截器实现")]),t._v(" "),s("p",[t._v("请求控制：1.除了登录请求都带上token,这样服务器才能鉴别你的身份。2.如果发出非权限内的请求，\n可以在axios的请求拦截器进行阻止（判断路由规则的meta元信息的权限信息）")]),t._v(" "),s("p",[t._v("响应控制")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("axios"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interceptors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reponse"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("meta"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    router"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/login'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sessionStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reload")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("权限控制：")]),t._v(" "),s("ul",[s("li",[t._v("权限控制流程")]),t._v(" "),s("li",[t._v("动态渲染菜单")]),t._v(" "),s("li",[t._v("细颗粒度权限控制，自定义全局指令的方式（组件级 细颗粒度，一个页面的元素有哪些，eg:删除按钮）")]),t._v(" "),s("li",[t._v("路由守卫的方式实现")])]),t._v(" "),s("ol",[s("li",[t._v("后台管理系统使用 RBAC\n用户 角色 权限\n首先给用户给用户选择一个或多个已存在的角色，每个角色可以控制自己拥有哪些任务的权限。\n角色：管理员，经办人员，中心端人员   给角色配置相应的权限")])]),t._v(" "),s("p",[t._v("方案一（项目方案）：")]),t._v(" "),s("p",[t._v("获取用户的permissionId列表和显示的菜单列表，同时在路由的配置，给每个菜单配置相应的permissionId,\n在显示的菜单列表，通过路由守卫的方式，如果发现，该用户无对应的菜单权限，则提示用户需要获取权限。\nmeta: permissionId, hidden")]),t._v(" "),s("p",[t._v("缺点：")]),t._v(" "),s("ul",[s("li",[t._v("全局路由守卫，每次路由跳转，都要进行权限判断。")]),t._v(" "),s("li",[t._v("菜单信息写死在前端，要改显示文字或权限信息，需要重新编译。")])]),t._v(" "),s("p",[t._v("接口权限：token ，用户权限列表与 当前页面权限 , 二次封装axios, 在请求和响应拦截器 ，\n路由权限呢：\n菜单权限呢：")]),t._v(" "),s("p",[t._v("登录后，获取菜单列表，存在vuex + sessionStorage, 渲染菜单列表。\n导航守卫，防止用户跳过登录页面。没token 前往需要token的页面，返回登录页面\n用户不具备权限的路由，是否要添加到路由映射表/路由规则呢 ？动态路由\n根据用户所具备的权限，动态添加路由规则。（根据二级权限，对路由规则进行动态的添加）\ninitDynamicRoutes()动态路由添加的两个时机？登陆后，App的created钩子 （防止刷新，丢失Router数据）")]),t._v(" "),s("p",[t._v("请求控制：通过axios的请求/响应拦截器\n请求控制\n1.除了登录请求都要携带token数据，这样服务器才能鉴别你的身份。\n2.如果发出了非权限内的请求，应该直接在前端访问内进行阻止，虽然这个请求发送到服务器也会被拒绝。（按钮\n的禁用，通过f12进行非法操作）（判断非权限范围内的请求）\n响应控制")])])}),[],!1,null,null,null);s.default=e.exports}}]);